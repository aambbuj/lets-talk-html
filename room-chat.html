<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chat Room</title>
  <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
  <script src="js/config.js"></script>
  <link rel="stylesheet" href="css/room.css"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
  <div class="chat-container">
    <!-- Header -->
    <div class="chat-header">
      <div class="header-left">
        <button class="back-btn" onclick="history.back()">
          <i class="fas fa-arrow-left"></i>
        </button>
        <div class="user-info">
          <div class="avatar" id="avatar">
            <i class="fas fa-user"></i>
          </div>
          <div class="user-details">
            <div class="user-name" id="peerName">Chat</div>
            <div class="user-status">
              <div class="status-dot" id="statusDot"></div>
              <span id="presenceText">Online</span>
            </div>
          </div>
        </div>
      </div>
      <div class="header-right">
        <button class="header-btn" id="btnVideoCall">
          <i class="fas fa-video"></i>
        </button>
        <button class="header-btn" id="btnMore">
          <i class="fas fa-ellipsis-v"></i>
        </button>
      </div>
    </div>

    <!-- Chat Messages -->
    <div class="chat-messages" id="chatList">
      <!-- Messages will be inserted here -->
    </div>

    <!-- Typing Indicator -->
    <div class="typing-indicator" id="typingBar" style="display: none;">
      <div class="typing-dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
      <span class="typing-text">Someone is typing...</span>
    </div>

    <!-- Input Area -->
    <div class="chat-input">
      <div class="input-wrapper">
        <input type="text" id="msg" placeholder="Type a message..." />
        <button class="send-btn" id="sendBtn">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>
  </div>

  <script src="js/room.js?v=20250819"></script>
  <script>
    // Ensure mode parameter is set
    if (!location.search.includes('mode=')) { 
      const u = new URL(location.href); 
      u.searchParams.set('mode','chat'); 
      location.replace(u.toString()); 
    }
    
    // Video call button
    document.getElementById('btnVideoCall').onclick = () => {
      const url = new URL(location.href);
      url.pathname = url.pathname.replace('room-chat.html', 'room-video.html');
      url.searchParams.set('mode', 'video');
      window.location.href = url.toString();
    };
  </script>
</body>
</html>


