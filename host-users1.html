<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="fast2sms" content="CDvDuBmuaXzCy99Ehd5iZcfnwvSoCM0Y"/>
  <title>Users</title>
  
  <!-- API Configuration -->
  <script src="js/config.js"></script>
  
  <!-- Environment Switcher (for development) -->
  <script src="js/env-switcher.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', sans-serif;
    }
    
    /* body, html {*/
    /*  user-select: none;*/
    /*  -webkit-user-select: none;*/
    /*  -moz-user-select: none;*/
    /*  -ms-user-select: none;*/
    /*}*/

    body {
      background: linear-gradient(to bottom, #f8c6d8, #fddae3);
      display: flex;
      justify-content: center;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      width: 100%;
      max-width: 400px;
      background: linear-gradient(to bottom, #f8c6d8, #fddae3);
      border-radius: 10px;
      overflow-y: auto;
      padding: 20px;
      box-shadow: 0 0 10px #00000060;
    }

    .header {
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 20px;
      color: #fff;
      background-color: #d6006d;
      padding: 10px;
      border-radius: 10px;
    }
    
   
/* Make bell blink */
.blink-bell img {
  animation: blink 1s infinite;
}

@keyframes blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0; }
}


/*    .user-card {*/
/*      display: flex;*/
/*      align-items: flex-start;*/
/*      background-color: #fff;*/
/*      border-radius: 10px;*/
/*      padding: 12px;*/
/*      margin-bottom: 15px;*/
/*      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);*/
/*    }*/
    
    

/*    .user-card img {*/
/*  height: 100px;*/
/*  object-fit: cover;*/
/*  border-radius: 10px;*/
/*  margin-right: 10px;*/
/*  transition: transform 0.3s ease-in-out;*/
/*  cursor: pointer;*/
/*}*/

/*.user-card img:hover {*/
/*  transform: scale(2.60);*/
/*  z-index: 100;*/
/*  margin-left:6em;*/
/*}*/

.user-card {
  display: flex;
  align-items: flex-start;
  background-color: #fff;
  border-radius: 10px;
  padding: 12px;
  margin-bottom: 15px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  overflow: hidden; /* Prevent image from overflowing */
  position: relative; /* Needed for proper containment */
}

.user-card img {
  height: 90px;
  width:28%;
  object-fit: cover;
  border-radius: 10px;
  margin-right: 10px;
  transition: transform 0.3s ease-in-out;
  cursor: pointer;
  display: block;
  transform-origin: center center; /* Zoom from center */
}

.user-card img:hover {
  transform: scale(2.0); /* Gentle zoom */
 margin-left:3em;
 margin-top:1em;
  z-index: 1;
}

    .user-info {
      flex: 1;
    }

    .user-info h3 {
      font-size: 16px;
      margin-bottom: 4px;
    }

    .user-info p {
      font-size: 13px;
      color: #444;
      margin-bottom: 3px;
    }
    
     .goog-logo-link,
    .goog-te-gadget span {
      display: none !important;
    }

    #google_translate_element {
      color: transparent !important;
    }

    .goog-te-gadget {
      color: #66666600 !important;
    }

    .call-btn {
      margin-top: 8px;
      padding: 6px 14px;
      background-color: #d6006d;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
    }

    .footer-nav {
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      background: #f84d91;
      width: 100%;
      max-width: 400px;
      height: 60px;
      border-top-left-radius: 16px;
      border-top-right-radius: 16px;
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 0 10px;
      box-shadow: 0 -2px 10px #00000030;
      z-index: 1000;
    }

    .footer-item {
      width: 40px;
      height: 40px;
      background: #ffffffaa;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 2px 5px #00000020;
      cursor: pointer;
    }

    .footer-item img {
      width: 20px;
      height: 20px;
    }

    .footer-center {
      width: 60px;
      height: 60px;
      background: #fff;
      border-radius: 50%;
      position: absolute;
      top: -25px;
      left: 50%;
      transform: translateX(-50%);
      box-shadow: 0 4px 8px #00000030;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2;
    }

    .footer-center img {
      width: 30px;
      height: 30px;
    }
    
    #usersList {
  max-height: 70vh; /* keeps some space for the header & footer */
  overflow-y: auto;
  padding-right: 5px; /* avoid text cutting at scrollbar */
}

#usersList::-webkit-scrollbar {
  width: 6px;
}
#usersList::-webkit-scrollbar-thumb {
  background: #d6006d;
  border-radius: 4px;
}
#usersList::-webkit-scrollbar-track {
  background: transparent;
}

    @media (max-width: 480px) {
      .user-card {
        flex-direction: row;
        align-items: flex-start;
      }

      .user-card img {
        /*width: 55px;*/
        height: 65px;
      }

      .user-info h3 {
        font-size: 15px;
      }

      .call-btn {
        font-size: 13px;
        padding: 6px 12px;
      }
    }
  </style>
</head>
<body>

  <div class="container">
       <div id="google_translate_element"></div>
    <div class="header">Hosts</div>
    <div id="usersList">
      <!-- Fetched users will appear here -->
    </div>
  </div>

  <!-- Footer Navigation -->
  <div class="footer-nav">
    <div class="footer-item"><a href="call-list.html"><img src="icons/video.png" alt="Video"></a></div>
    <div class="footer-item"><a href="my-chats.html"><img src="icons/chat.png" alt="Chat"></a></div>

    <div class="footer-center">
     <a href="host-users.html"> <img src="imgs/logo11.png" alt="Main" /></a>
    </div>

    <div class="footer-item"><a href="notifications.html" class="blink-bell">
    <img src="icons/bell.png" alt="Notification">
  </a></div>  
    <div class="footer-item"><a href="profile1.html"><img src="icons/user.png" alt="Profile"></a></div>
  </div>

  <script>
    // Check authentication on page load
    document.addEventListener('DOMContentLoaded', function() {
      if (!checkAuth()) {
        return;
      }
      fetchUsers();
    });

    function checkAuth() {
      const token = localStorage.getItem('authToken');
      if (!token) {
        showAuthError();
        return false;
      }
      return true;
    }

    function showAuthError() {
      const container = document.querySelector('.container');
      const errorDiv = document.createElement('div');
      errorDiv.className = 'auth-error';
      errorDiv.style.cssText = 'background: #ffebee; color: #c62828; padding: 15px; text-align: center; border-radius: 5px; margin: 20px;';
      errorDiv.innerHTML = `
        <h3>⚠️ Authentication Required</h3>
        <p>Please login to access this page.</p>
        <button onclick="window.location.href='login.html'" style="background: #d6006d; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 10px;">Go to Login</button>
      `;
      container.insertBefore(errorDiv, container.firstChild);
    }

    async function fetchUsers() {
      const usersList = document.getElementById("usersList");
      usersList.innerHTML = '<p style="text-align: center; color: #666;">Loading hosts...</p>';
      
      try {
        // Get auth token from localStorage
        const token = localStorage.getItem('authToken');
        
        if (!token) {
          usersList.innerHTML = '<p style="text-align: center; color: #ff4444;">Please login first to view hosts.</p>';
          return;
        }
        
        // Try different API endpoints to get only hosts
        const res = await fetch(API_CONFIG.getAuthUrl('/get-host-details'), {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${token}`
          }
        });
        
        const data = await res.json();
        console.log("API Response:", data); // For debugging
        console.log("Total users returned:", data.data ? data.data.length : 0);

        if (res.ok && data.success && Array.isArray(data.data)) {
          usersList.innerHTML = '';
          
          if (data.data.length === 0) {
            usersList.innerHTML = '<p style="text-align: center; color: #666;">No hosts available at the moment.</p>';
            return;
          }

          // Filter to show only actual hosts (you might need to adjust this logic)
          let hosts = data.data;
          
          // If you have a specific field to identify hosts, uncomment and modify this:
          // hosts = data.data.filter(user => user.isHost === true || user.role === 'host' || user.user_type === 'host');
          
          console.log("Filtered hosts count:", hosts.length);
          
          // Show only first 5 hosts if there are too many (for debugging)
          if (hosts.length > 5) {
            console.log("Too many users returned, showing only first 5 for debugging");
            hosts = hosts.slice(0, 5);
          }

          hosts.forEach((user, index) => {
            console.log(`User ${index + 1}:`, user); // Log each user for debugging
            
            // Safely handle image URL with fallback
            let imageUrl = "imgs/logo11.png"; // Default fallback
            if (user.Images && Array.isArray(user.Images) && user.Images.length > 0) {
              const lastImage = user.Images[user.Images.length - 1];
              if (lastImage && lastImage.url) {
                imageUrl = lastImage.url;
              }
            }
            
            const userCard = document.createElement("div");
            userCard.className = "user-card";
            userCard.innerHTML = `
              <img src="${imageUrl}" alt="${user.name || 'Host'}" onerror="this.src='imgs/logo11.png'">
              <div class="user-info">
                <h3>${user.name || "Unknown Host"}</h3>
                <p>Gender: ${user.gender || "N/A"}</p>
                <p>Phone: ${user.phone || "N/A"}</p>
                <p>Email: ${user.email || "N/A"}</p>
                <button class="call-btn" onclick="initiateCall('${user.user_profile_id || user.id}')">CALL NOW</button>
              </div>
            `;
            usersList.appendChild(userCard);
          });
          
          // Add debug info
          // if (data.data.length > 5) {
          //   const debugInfo = document.createElement("div");
          //   debugInfo.style.cssText = "background: #ffeb3b; padding: 10px; margin: 10px 0; border-radius: 5px; font-size: 12px;";
          //   debugInfo.innerHTML = `<strong>Debug Info:</strong> API returned ${data.data.length} users, showing only first 5. Check console for details.`;
          //   usersList.appendChild(debugInfo);
          // }
        } else {
          console.error("API Error:", data);
          usersList.innerHTML = `<p style="text-align: center; color: #ff4444;">${data.message || 'Failed to load hosts. Please try again.'}</p>`;
        }
      } catch (error) {
        console.error("Error fetching users:", error);
        usersList.innerHTML = '<p style="text-align: center; color: #ff4444;">Network error. Please check your connection and try again.</p>';
      }
    }

    function initiateCall(hostId) {
      if (!hostId) {
        alert('Host ID not available');
        return;
      }
      // Redirect to call page or initiate call logic
      window.location.href = `callrate.html?host=${hostId}`;
    }

    // Alternative API function to test different endpoints
    async function testAlternativeAPI() {
      const usersList = document.getElementById("usersList");
      usersList.innerHTML = '<p style="text-align: center; color: #666;">Testing alternative API...</p>';
      
      try {
        // Get auth token from localStorage
        const token = localStorage.getItem('authToken');
        
        if (!token) {
          usersList.innerHTML = '<p style="text-align: center; color: #ff4444;">Please login first to test alternative API.</p>';
          return;
        }
        
        // Try a different endpoint that might return only hosts
        const res = await fetch(API_CONFIG.getAuthUrl('/users?role=host&isHost=true'), {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${token}`
          }
        });
        
        const data = await res.json();
        console.log("Alternative API Response:", data);
        
        if (res.ok && data.success && Array.isArray(data.data)) {
          usersList.innerHTML = '';
          
          if (data.data.length === 0) {
            usersList.innerHTML = '<p style="text-align: center; color: #666;">No hosts found with alternative API.</p>';
            return;
          }
          
          data.data.forEach(user => {
            const userCard = document.createElement("div");
            userCard.className = "user-card";
            userCard.innerHTML = `
              <img src="${user.Images?.[0]?.url || 'imgs/logo11.png'}" alt="${user.name || 'Host'}" onerror="this.src='imgs/logo11.png'">
              <div class="user-info">
                <h3>${user.name || "Unknown Host"}</h3>
                <p>Gender: ${user.gender || "N/A"}</p>
                <p>Phone: ${user.phone || "N/A"}</p>
                <p>Email: ${user.email || "N/A"}</p>
                <button class="call-btn" onclick="initiateCall('${user.user_profile_id || user.id}')">CALL NOW</button>
              </div>
            `;
            usersList.appendChild(userCard);
          });
        } else {
          usersList.innerHTML = '<p style="text-align: center; color: #ff4444;">Alternative API failed. Check console for details.</p>';
        }
      } catch (error) {
        console.error("Alternative API Error:", error);
        usersList.innerHTML = '<p style="text-align: center; color: #ff4444;">Alternative API failed. Check console for details.</p>';
      }
    }
    
    // Clear debug info
    function clearDebug() {
      const usersList = document.getElementById("usersList");
      usersList.innerHTML = '<p style="text-align: center; color: #666;">Debug cleared. Reloading hosts...</p>';
      setTimeout(() => fetchUsers(), 1000);
    }
    
    // Add event listeners
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('testAlternativeAPI').addEventListener('click', testAlternativeAPI);
      document.getElementById('clearDebug').addEventListener('click', clearDebug);
    });
    
    // Fetch users is now called after auth check in DOMContentLoaded
  </script>
   <script>
    // ðŸš« Disable right-click context menu
    // document.addEventListener('contextmenu', event => event.preventDefault());

    // ðŸš« Disable PrintScreen key (attempted workaround)
    // document.addEventListener('keyup', function (e) {
    //   if (e.key === 'PrintScreen') {
    //     navigator.clipboard.writeText('');
    //     alert('Screenshot disabled on this page.');
    //   }
    // });

    // ðŸš« Disable Ctrl+U, Ctrl+Shift+I, Ctrl+S, F12, etc.
    document.addEventListener('keydown', function(e) {
      if (
        (e.ctrlKey && e.key === 'u') || // View Source
        (e.ctrlKey && e.shiftKey && e.key === 'I') || // Dev Tools
        (e.ctrlKey && e.key === 's') || // Save Page
        (e.key === 'F12')
      ) {
        e.preventDefault();
        alert('This action is disabled.');
      }
    });

    // âœ… Safe clipboard write (no read, no popup)
    // function copyText(text) {
    //   navigator.clipboard.writeText(text)
    //     .then(() => alert("Text copied safely."))
    //     .catch(err => console.error("Copy failed", err));
    // }

    // Example copy button
    // const copyBtn = document.createElement('button');
    // copyBtn.textContent = "Copy Message";
    // copyBtn.onclick = () => copyText("This is protected content.");
    // document.body.appendChild(copyBtn);
  </script>
  
  <script type="text/javascript">
  function googleTranslateElementInit() {
    new google.translate.TranslateElement({ pageLanguage: 'en', autoDisplay: false }, 'google_translate_element');
  }
</script>
<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

</body>
</html>
